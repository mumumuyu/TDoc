# 网络编程

知道要发给谁，发什么，谁发的就可以通信

数据是信息的载体

那么，如何定位对方地址呢？

1. 使用ip + 端口port
2. 如何传输呢？

javaweb: 网页编程 B/S

网络编程： TCP/IP C/S

### 通信要素

如何实现通信？

需要双方地址：

- ip	公网ipv4 or ipv6
- port

协议：http,ftp,udp,tcp，smtp

OSI七层模型

理论五层：应用层	传输层	网络层	数据链路层 物理层

TCP/IP四层

这里我们主要学习下传输层的TCP,UDP

具体计网这门课很多内容课上学，通信= =

1. 网络编程的问题
   - 如何准确定位一台或多台？ip+port
   - 找到后如何通信？socket（口袋）
2. 要素
   - 上述ip + pory
   - 通信协议udp tcp
3. 万物皆对象，没有咱就new一个

### IP

ip地址：InetAddress

- 唯一定位一台网络上的计算机

- 127.0.0.1   localhost

- ip分类

  - ip地址分类

    - v4 42亿个（30亿个在北美，🤮）

    - v6 128位 8个无符号整数 沙子都行

      ```
      2001:0bb3:adad:0042:5656:2312:4dsa:d56s
      ```

  - 公网(Internet)与私网（局域网）

    - 192.168.xx.xx
    - ABCD类地址

- 域名：记忆IP，因为IP一堆数字记不住

  - 域名比如www.baidu.com,www.leigd.cn

```java
InetAddress byName1 = InetAddress.getByName("127.0.0.1");
System.out.println(byName1);
InetAddress byName2 = InetAddress.getByName("localhost");
System.out.println(byName2);
InetAddress byName3 = InetAddress.getLocalHost();
System.out.println(byName3);

InetAddress byName = InetAddress.getByName("www.leigd.cn");
System.out.println(byName);///域名or电脑名 + ip
System.out.println(byName.getCanonicalHostName());//规范的名字
System.out.println(byName.getHostName());//域名，或者自己电脑的名字
```

### 端口 Port

表示计算机上的一个程序的进程

- 不同的进程有不同端口号，端口号必然不阔以冲突

- 一般端口为0~65535、

- TCP,UDP ： 2*xxx

- 端口分类

  - 公有端口 0 ~1023

    - http 默认端口80
    - https: 43 （SSL密钥）
    - FTP: 21
    - Telent: 23

  - 程序注册端口： 1024~49151,分配用户或程序

    - Tomcat: 8080
    - MySQL: 3306
    - Oracle： 1521
    - IDEA：66432

  - 动态，私有：49152~65535

    ```
    netstat -ano
    netstat -ano|findstr 5900
    ```
    

```java
InetSocketAddress inetSocketAddress = new InetSocketAddress("127.0.0.1", 8080);
System.out.println(inetSocketAddress);

System.out.println(inetSocketAddress.getHostName());
System.out.println(inetSocketAddress.getAddress());
System.out.println(inetSocketAddress.getPort());
```

### 通信协议

协议就是约定，约定俗成的一些配置如速率，传输码率，代码结构，传输控制……

太复杂，就大事化小，比如纯web配置太麻烦，就给你们弄了个spring框架提升效率，spring配置地狱太麻烦就又弄了个springboot。lib导包也麻烦就出了个Maven（个人理解）

TCP/IP： 是一组协议

- TCP：用户传输协议：打电话

  - 连接，稳定

  - 三次握手，四次挥手

    ```
    三次握手：
    A：请求
    B: 可以
    A: 收到，来
    
    四次挥手：
    看了专业书再来= =
    ```

  - 客户端，服务端

- UDP：用户数据报协议：发短信

  - 不连接，不稳定
  - 客户端与服务端没有明确界限
  - 无论对方准没准备好，都可以发给你
  - DDOS：洪水攻击，发一堆无用请求给你，造成服务器堵塞

- IP：网络互连协议

### TCP实现聊天

这里我没有try-catch

在真实是应用中一定要多用try--catch

这样即使我们的代码出错了，也不会导致服务一下子崩掉

Cilent

```java
InetAddress byName = InetAddress.getByName("127.0.0.1");
        int port = 9999;
        Socket socket = new Socket(byName,port);
        //发消息 IO流
        OutputStream outputStream = socket.getOutputStream();

        outputStream.write("你好，这里是客户端".getBytes(StandardCharsets.UTF_8));

        socket.close();
        outputStream.close();
```

Server

```java
ServerSocket serverSocket = new ServerSocket(9999);
        //获取到连过来的客户端
        Socket accept = serverSocket.accept();
        // 读取客户端消息
        InputStream inputStream = accept.getInputStream();
        //管道流
        ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
        byte[] buffer = new byte[1024];
        int len;
        while((len=inputStream.read(buffer))!=-1){
            byteArrayOutputStream.write(buffer,0,len);
        }
        System.out.println(byteArrayOutputStream.toString());

        inputStream.close();
        accept.close();
        byteArrayOutputStream.close();
```

总结来说就是：

- 先建立服务的端口 Server Socket
- 然后等待用户的连接 accept
- 接受到用户的信息

